var App,Glue,Gui,LocalStorage,UseCase,__hasProp={}.hasOwnProperty,__bind=function(a,b){return function(){return a.apply(b,arguments)}};_.defaults(this,{Before:function(a,b,c){return YouAreDaBomb(a,b).before(c)},BeforeAnyCallback:function(a,b,c){return YouAreDaBomb(a,b).beforeAnyCallback(c)},After:function(a,b,c){return YouAreDaBomb(a,b).after(c)},Around:function(a,b,c){return YouAreDaBomb(a,b).around(c)},AfterAll:function(a,b,c){var d,e,f,g;g=[];for(e=0,f=b.length;e<f;e++)d=b[e],g.push(After(a,d,c));return g},LogAll:function(a,b){var c,d,e;e=[];for(c in a){if(!__hasProp.call(a,c))continue;d=a[c],_.isFunction(d)?e.push(function(c){return Before(a,c,function(){return console.log("calling: "+b+"::"+c)})}(c)):e.push(void 0)}return e},AutoBind:function(a,b){var c,d,e;e=[];for(c in a)d=a[c],_.isFunction(d)?e.push(function(c){if(c.endsWith("Clicked")&&b[c.remove("Clicked")])return After(a,c,function(a){return b[c.remove("Clicked")](a)})}(c)):e.push(void 0);return e}}),UseCase=function(){function a(){this.codeChanged=__bind(this.codeChanged,this),this.initCodeView=__bind(this.initCodeView,this),this.signOut=__bind(this.signOut,this),this.settings=__bind(this.settings,this),this.messages=__bind(this.messages,this),this.ranking=__bind(this.ranking,this),this.status=__bind(this.status,this),this.problem=__bind(this.problem,this),this.contestWelcome=__bind(this.contestWelcome,this),this.openContest=__bind(this.openContest,this),this.loadContestList=__bind(this.loadContestList,this),this.signInError=__bind(this.signInError,this),this.signIn=__bind(this.signIn,this),this.start=__bind(this.start,this),this.contest={}}return a.prototype.start=function(){},a.prototype.signIn=function(a){return a?this.loadContestList():this.signInError()},a.prototype.signInError=function(){},a.prototype.loadContestList=function(){},a.prototype.openContest=function(a){return this.contestWelcome()},a.prototype.contestWelcome=function(){},a.prototype.problem=function(){},a.prototype.status=function(){},a.prototype.ranking=function(){},a.prototype.messages=function(){},a.prototype.settings=function(){},a.prototype.signOut=function(){},a.prototype.initCodeView=function(){},a.prototype.codeChanged=function(a){},a}(),Glue=function(){function a(a,b,c){var d=this;this.useCase=a,this.gui=b,this.storage=c,AutoBind(this.gui,this.useCase),LogAll(this.useCase,"UseCase"),LogAll(this.gui,"Gui"),LogAll(this.storage,"Storage"),After(this.useCase,"start",this.gui.start),After(this.gui,"signIn",function(a){return d.storage.signIn(a)}),After(this.storage,"signInResponse",function(a){return d.useCase.signIn(a)}),After(this.useCase,"signInError",this.gui.signInError),After(this.useCase,"signOut",this.gui.signOut),After(this.useCase,"loadContestList",function(){return d.gui.showContestList(d.storage.getContestList())}),Before(this.useCase,"openContest",function(a){return d.gui.showContestArea(d.storage.getContest(a))}),After(this.useCase,"contestWelcome",function(){return d.gui.showContestWelcome({})}),After(this.useCase,"problem",function(){return d.gui.showProblem({})}),After(this.useCase,"status",function(){return d.gui.showStatus([])}),After(this.useCase,"ranking",function(){return d.gui.showRanking({})}),After(this.useCase,"messages",function(){return d.gui.showMessages([])}),After(this.useCase,"settings",function(){return d.gui.showSettingsForm({})})}return a}(),LocalStorage=function(){function a(a){this.namespace=a,this.getContest=__bind(this.getContest,this),this.getContestList=__bind(this.getContestList,this),this.signInResponse=__bind(this.signInResponse,this),this.signIn=__bind(this.signIn,this),this.getCode=__bind(this.getCode,this),this.setCode=__bind(this.setCode,this),this.flush=__bind(this.flush,this),this.remove=__bind(this.remove,this),this.get=__bind(this.get,this),this.set=__bind(this.set,this)}return a.prototype.set=function(a,b){return $.jStorage.set(""+this.namespace+"/"+a,b)},a.prototype.get=function(a){return $.jStorage.get(""+this.namespace+"/"+a)},a.prototype.remove=function(a){return $.jStorage.deleteKey(""+this.namespace+"/"+a)},a.prototype.flush=function(){var a,b,c,d,e;d=$.jStorage.index(),e=[];for(b=0,c=d.length;b<c;b++)a=d[b],a.match("^"+this.namespace)?e.push($.jStorage.deleteKey(a)):e.push(void 0);return e},a.prototype.setCode=function(a){return this.set("code",a)},a.prototype.getCode=function(){return this.get("code")||'#include<iostream>\nusing namespace std;\n\nint main() {\n    cout << "Hello World!" << endl;\n    return 0;\n}'},a.prototype.signIn=function(a){var b,c=this;return b=a.email===""&&a.password==="",setTimeout(function(){return c.signInResponse(b)},700)},a.prototype.signInResponse=function(a){},a.prototype.getContestList=function(){return[{id:1,name:"NSN Programming Open (Qualification Round I)",date:"27.06.2013 17:00",registered:!0,active:!0},{id:2,name:"NSN AlgoMatch C++ #1",date:"15.07.2013 19:00",registered:!0,active:!1},{id:3,name:"NSN AlgoMatch C++ #2",date:"31.07.2013",registered:!1},{id:4,name:"NSN Programming Open (Qualification round II)",date:"08.08.2013",registered:!1},{id:5,name:"NSN AlgoMatch C++ #3",date:"19.08.2013",registered:!1},{id:6,name:"NSN AlgoMatch C++ #4",date:"28.08.2013",registered:!1},{id:7,name:"NSN Programming Open Finals",date:"05.09.2013",registered:!1}]},a.prototype.getContest=function(a){return{name:"Web Programming Contest demo",problems:[{id:1,name:"Problem 1"},{id:2,name:"Stones in my passway"},{id:3,name:"Brilliant room"},{id:4,name:"Driving towards the daylight"},{id:5,name:"Planet Welfare"},{id:6,name:"Gem"}]}},a}(),App=function(){function a(){var a,b,c,d;d=new UseCase,b=new Gui,c=new LocalStorage("webcontest"),a=new Glue(d,b,c),d.start()}return a}(),$(function(){return new App}),Gui=function(){function a(){this.codeChanged=__bind(this.codeChanged,this),this.saveCodeCallback=__bind(this.saveCodeCallback,this),this.setCodeViewFullScreen=__bind(this.setCodeViewFullScreen,this),this.isCodeViewFullScreen=__bind(this.isCodeViewFullScreen,this),this.initCodeView=__bind(this.initCodeView,this),this.signOut=__bind(this.signOut,this),this.showSettingsForm=__bind(this.showSettingsForm,this),this.showMessages=__bind(this.showMessages,this),this.showRanking=__bind(this.showRanking,this),this.showStatus=__bind(this.showStatus,this),this.showProblem=__bind(this.showProblem,this),this.showContestWelcome=__bind(this.showContestWelcome,this),this.signOutClicked=__bind(this.signOutClicked,this),this.settingsClicked=__bind(this.settingsClicked,this),this.messagesClicked=__bind(this.messagesClicked,this),this.rankingClicked=__bind(this.rankingClicked,this),this.statusClicked=__bind(this.statusClicked,this),this.problemClicked=__bind(this.problemClicked,this),this.contestWelcomeClicked=__bind(this.contestWelcomeClicked,this),this._setActiveNavMenuItem=__bind(this._setActiveNavMenuItem,this),this._loadProblemsMenu=__bind(this._loadProblemsMenu,this),this.showContestArea=__bind(this.showContestArea,this),this.openContestClicked=__bind(this.openContestClicked,this),this.registerForContestClicked=__bind(this.registerForContestClicked,this),this.showContestList=__bind(this.showContestList,this),this.signInError=__bind(this.signInError,this),this.signIn=__bind(this.signIn,this),this.signInFired=__bind(this.signInFired,this),this.showSignInForm=__bind(this.showSignInForm,this),this.start=__bind(this.start,this),this._setLayout=__bind(this._setLayout,this),this._render=__bind(this._render,this),this.saveCodeEvery=15}return a.prototype._render=function(a,b,c){var d;return console.log("template = "+a),a=Handlebars.templates[a],d=a(c),$(b).html(d)},a.prototype._setLayout=function(a){return this._render("layout-"+a+".tmpl","body",{})},a.prototype.start=function(){return this._setLayout("center"),this.showSignInForm()},a.prototype.showSignInForm=function(){var a=this;return this._render("sign-in.tmpl","#main",{}),$("#sign-in").click(function(){return a.signInFired()}),$("#email").enterKey(function(){return a.signInFired()}),$("#password").enterKey(function(){return a.signInFired()})},a.prototype.signInFired=function(){var a;return a={email:$("#email").val(),password:$("#password").val()},this.signIn(a)},a.prototype.signIn=function(a){return $("#sign-in").off("click").addClass("disabled").text("Signing in..."),$("#sign-in-error").hide("fast")},a.prototype.signInError=function(){var a=this;return $("#sign-in-error").show("fast"),$("#sign-in").removeClass("disabled").text("Sign in").click(function(){return a.signInFired()})},a.prototype.showContestList=function(a){var b=this;return console.log(a),this._render("contest-list.tmpl","#main",a),$(".register-for-contest").click(function(a){return b.registerForContestClicked(a.toElement.id)}),$(".open-contest").click(function(a){return b.openContestClicked(a.toElement.id)})},a.prototype.registerForContestClicked=function(a){},a.prototype.openContestClicked=function(a){},a.prototype.showContestArea=function(a){var b=this;return console.log(a),this._setLayout("navbar"),$("#contest-welcome").text(a.name),this._loadProblemsMenu(a.problems),$("#contest-welcome").click(function(){return b.contestWelcomeClicked()}),$("#status").click(function(){return b.statusClicked()}),$("#ranking").click(function(){return b.rankingClicked()}),$("#messages").click(function(){return b.messagesClicked()}),$("#settings").click(function(){return b.settingsClicked()}),$("#sign-out").click(function(){return b.signOutClicked()})},a.prototype._loadProblemsMenu=function(a){var b=this;return a.each(function(a){var c;return c=$("<a>").attr("id",a.id).text(a.name).click(function(a){return b.problemClicked(a.toElement.id)}),$("ul#problems-list").append($("<li>").append(c))})},a.prototype._setActiveNavMenuItem=function(a){$("ul#navigation li").removeClass("active");if(a!=="")return $("#"+a).parent().addClass("active")},a.prototype.contestWelcomeClicked=function(){return this._setActiveNavMenuItem("")},a.prototype.problemClicked=function(a){return this._setActiveNavMenuItem("problems")},a.prototype.statusClicked=function(){return this._setActiveNavMenuItem("status")},a.prototype.rankingClicked=function(){return this._setActiveNavMenuItem("ranking")},a.prototype.messagesClicked=function(){},a.prototype.settingsClicked=function(){},a.prototype.signOutClicked=function(){},a.prototype.showContestWelcome=function(a){var b,c,d,e=this;return this._render("welcome.tmpl","#main",a),b=[{start:new Date(2012,12,24,13,0,0),content:"Registration end [13:00]"},{start:new Date(2012,12,24,13,10,0),end:new Date(2012,12,24,14,0,0),content:"Trial round [13:10 - 14:00]"},{start:new Date(2012,12,24,14,15,0),end:new Date(2012,12,24,18,0,0),content:"Main round [14:15 - 18:00]"},{start:new Date(2012,12,24,17,30,0),content:"Ranking freeze [17:30]"},{start:new Date(2012,12,24,18,30,0),content:"Results publish [18:30]"}],c={width:"100%",height:"150px",zoomable:!1,selectable:!1,moveable:!1,showMajorLabels:!1,showCurrentTime:!1,showCustomTime:!0,scale:links.Timeline.StepDate.SCALE.HOURS,step:1},d=new links.Timeline(document.getElementById("mytimeline")),d.setCustomTime(new Date(2012,12,24,16,5,22)),d.draw(b,c),$(window).on("resize",function(){return d.redraw()})},a.prototype.showProblem=function(a){return this._render("problem.tmpl","#main",a)},a.prototype.showStatus=function(a){return this._render("status.tmpl","#main",a)},a.prototype.showRanking=function(a){return this._render("ranking.tmpl","#main",a)},a.prototype.showMessages=function(a){return this._render("messages.tmpl","#main",a)},a.prototype.showSettingsForm=function(a){return this._render("settings.tmpl","#main",a)},a.prototype.signOut=function(){return this.start()},a.prototype.initCodeView=function(a){var b,c,d=this;return c={mode:"text/x-c++src",theme:"monokai",lineNumbers:!0,indentUnit:4,extraKeys:{F11:function(a){return d.setCodeViewFullScreen(a,!d.isCodeViewFullScreen(a))},Esc:function(a){if(d.isCodeViewFullScreen(a))return d.setCodeViewFullScreen(a,!1)}}},b=document.getElementById("code"),this.cm=CodeMirror.fromTextArea(b,c),this.cm.setValue(a),this.cm.markClean(),setTimeout(this.saveCodeCallback,this.saveCodeEvery*1e3)},a.prototype.isCodeViewFullScreen=function(a){return/\bCodeMirror-fullscreen\b/.test(a.getWrapperElement().className)},a.prototype.setCodeViewFullScreen=function(a,b){var c,d;return d=a.getWrapperElement(),c=window.innerHeight||(document.documentElement||document.body).clientHeight,b?(d.className+=" CodeMirror-fullscreen",d.style.height=c+"px",document.documentElement.style.overflow="hidden"):(d.className=d.className.replace(" CodeMirror-fullscreen",""),d.style.height="",document.documentElement.style.overflow=""),a.refresh()},a.prototype.saveCodeCallback=function(){return this.cm.isClean()||this.codeChanged(this.cm.getValue()),this.cm.markClean(),setTimeout(this.saveCodeCallback,this.saveCodeEvery*1e3)},a.prototype.codeChanged=function(a){},a}()